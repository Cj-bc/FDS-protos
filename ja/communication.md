# Face-Data-Server 通信プロトコル仕様書

このドキュメントでは、Face-Data-Serverで使用する通信プロトコル及び設定を定義します

## 通信方式

UDP通信、マルチキャストを使用します。

## 使用するポート・アドレス

| | |
|:-:|:-:|
| 使用するポート | 5032 |
| 使用するマルチキャストグループアドレス | 226.70.68.83 |


## アプリケーション層プロトコル

アプリケーション層には以下のプロトコルを使用します。

### 全体像

```
_______________________________________________
| version number (1 byte) | data (n byte)     |
-----------------------------------------------
```

データセクション展開後
```
______________________________________________________________________________________________________________________________________________________________________________________________________________________________
| version number (1 byte) | face_x radian (8 byte) | face_y radian (8 byte) | face_z radian (8 byte) | mouth_height_percent (1 byte) | mouth_width_percent (1 byte) | left_eye_percent (1 byte) | right_eye_percent (1 byte) |
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

### 各部分

| section | データ | 補足 |
| :-: |:-:|:-:|
| version number | bMMMMmmmm |　`MMM`はメジャーバージョン番号; `mmm`はマイナーバージョン番号; セマンティックバージョニング |
| data | データのバイナリ表現の列 |  |

#### data

具体的な各値を格納している部分。
現在確定している値は以下のとおり。
又、`data`に並ぶ順番も以下の通りとする。
各値の範囲は、サーバー側で満たされているかを検証してください。

| 表記                 | 長さ   | 値の範囲 | 単位       |説明                    |
| :-:                  |:-:     |  :-:     | :-:        |:-:                     |
| face_x_radian        | 8 byte | -pi ~ pi | ラジアン値 | 顔のX軸に対する回転    |
| face_y_radian        | 8 byte | -pi ~ pi | ラジアン値 | 顔のY軸に対する回転    |
| face_z_radian        | 8 byte | -pi ~ pi | ラジアン値 | 顔のZ軸に対する回転    |
| mouth_height_percent | 1 byte | 0~150    | 割合       | 口の縦向きの開き具合   |
| mouth_width_percent  | 1 byte | 0~150    | 割合       | 口の横向きの開き具合   |
| left_eye_percent     | 1 byte | 0~150    | 割合       | 左目の縦向きの開き具合 |
| right_eye_percent    | 1 byte | 0~150    | 割合       | 右目の縦向きの開き具合 |


### 備考

- ビッグエンディアンです
- Pythonの`float`は倍精度小数点数であるため、64bit(8byte)。元データを生成するのがPythonなのでそちらに合わせてある。
- メジャーバージョンが変わらない間は、後ろにデータを連ねていく方針

